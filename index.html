<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>TEAM Runners</title>
<style>
  :root{
    --team-red:#C9301F;
    --team-blue:#132766;
    --bg:#ffffff;
    --ink:#0f172a;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;min-height:100svh;padding:12px}
  .stage{position:relative;width:min(100vw, 1100px);aspect-ratio:16/9;touch-action:none}
  canvas{background:var(--bg);display:block;width:100%;height:100%;box-shadow:0 12px 40px rgba(0,0,0,.08);border-radius:18px;image-rendering:pixelated}
  .hud{position:absolute;inset:0;pointer-events:none} /* HUD сам клики не ловит... */
  .score{position:absolute;top:14px;right:16px;font-weight:800;font-size:22px;letter-spacing:.3px;
         background:rgba(255,255,255,.7);backdrop-filter:saturate(140%) blur(4px);
         border-radius:12px;padding:6px 10px;border:1px solid rgba(0,0,0,.06)}
  .start-overlay,.gameover{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;
    gap:14px;background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
    backdrop-filter: blur(4px);
    padding:12px; text-align:center;
    pointer-events:auto; /* FIX: а вот оверлеи кликабельные */
  }
  .title{font-weight:900;font-size:34px;color:var(--team-blue);letter-spacing:.3px}
  .subtitle{opacity:.85;max-width:90%}
  .row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}
  input[type="text"]{
    width:min(70vw,280px);appearance:none;border-radius:14px;border:2px solid var(--team-blue);
    padding:12px 14px;font-size:18px;font-weight:700;color:var(--team-blue);outline:none;background:#fff;pointer-events:auto
  }
  button{
    appearance:none;border:0;background:var(--team-red);color:#fff;font-weight:900;
    padding:12px 18px;border-radius:14px;font-size:18px;letter-spacing:.3px;
    box-shadow:0 8px 20px rgba(201,48,31,.25);cursor:pointer;transition:transform .08s ease, filter .15s ease;pointer-events:auto
  }
  button:disabled{filter:grayscale(1) brightness(.9);cursor:not-allowed}
  button:active{transform:translateY(1px)}
  .leader{
    width:min(100vw,1100px);border:1px solid rgba(0,0,0,.06);border-radius:16px;padding:12px 14px;
    box-shadow:0 10px 28px rgba(0,0,0,.05);background:#fff
  }
  .leader h3{margin:0 0 8px 0;font-size:18px;color:var(--team-blue)}
  .table{display:grid;grid-template-columns:48px 1fr 110px;gap:6px 10px;align-items:center}
  .thead{opacity:.6;font-weight:800}
  .cell{padding:6px 6px;border-radius:10px}
  .rank{font-weight:900;color:var(--team-blue)}
  .nick{font-weight:800;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .pts{font-weight:900;text-align:right;color:var(--team-red)}
  .hint{font-size:12px;opacity:.65}
</style>
</head>
<body>
  <div class="wrap">
    <div class="stage" id="stage">
      <canvas id="game" width="1920" height="1080"></canvas>
      <div class="hud" aria-hidden="true">
        <div class="score"><span id="score">0</span></div>

        <div class="start-overlay" id="startUI" role="dialog" aria-modal="true">
          <div class="title">TEAM Runners</div>
          <div class="subtitle">Перепрыгивай препятствия. Держись как можно дольше.</div>
          <div class="row">
            <input id="nick" type="text" maxlength="20" inputmode="text" autocomplete="off" placeholder="Ваш ник">
            <button id="startBtn" disabled>Начать</button>
          </div>
          <div class="hint">Ник обязателен. Управление: пробел / ↑ / тап для прыжка.</div>
        </div>

        <div class="gameover" id="overUI" style="display:none" role="dialog" aria-modal="true">
          <div class="title">Игра окончена</div>
          <div class="subtitle">Счёт: <b id="finalScore">0</b> • Рекорд: <b id="bestScore">0</b></div>
          <div class="row"><button id="againBtn">Играть ещё раз</button></div>
        </div>
      </div>
    </div>

    <div class="leader" id="leaderBox">
      <h3>Лидерборд (топ-15)</h3>
      <div class="table thead">
        <div class="cell">#</div><div class="cell">Ник</div><div class="cell" style="text-align:right">Очки</div>
      </div>
      <div id="leaderRows" class="table"></div>
      <div class="hint">Сохраняется локально. Для каждого ника хранится один лучший результат.</div>
    </div>
  </div>

<script>
(() => {
  const LOGICAL_W = 1920, LOGICAL_H = 1080;
  const GROUND_Y = LOGICAL_H - 200;

  // спокойные параметры
  let baseSpeed = 8.0, maxSpeed = 20.0, accelPerSecond = 0.020;
  const OBSTACLE_MIN_GAP = 320, OBSTACLE_MAX_GAP = 600, OBSTACLE_BASE_WIDTH = 58, OBSTACLE_MAX_HEIG
